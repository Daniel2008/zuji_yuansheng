# 足迹发布接口使用文档

## 概述

本文档介绍如何使用足迹发布接口 `http://192.168.1.5:8080/zuji/api/publishMsg` 来发布用户的足迹动态信息。

## 接口信息

- **接口地址**: `http://192.168.1.5:8080/zuji/api/publishMsg`
- **请求方式**: POST
- **内容类型**: application/x-www-form-urlencoded

## 数据模型

### PublishTrandsInfoPO

足迹发布参数实体类，包含以下字段：

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | String | 是 | 用户ID |
| locationInfo | String | 否 | 位置信息描述 |
| type | String | 否 | 足迹类型（如：旅游、美食、购物等） |
| content | String | 是 | 足迹内容描述 |
| tag | String | 否 | 标签，多个标签用逗号分隔 |
| imagePaths | List<String> | 否 | 图片文件路径列表 |
| lng | Double | 否 | 经度 |
| lat | Double | 否 | 纬度 |

## 代码实现

### 1. 实体类定义

```java
// 文件位置: com.damors.zuji.model.PublishTrandsInfoPO
public class PublishTrandsInfoPO {
    private String userId;
    private String locationInfo;
    private String type;
    private String content;
    private String tag;
    private List<String> imagePaths;
    private Double lng;
    private Double lat;
    
    // 构造函数和getter/setter方法
}
```

### 2. API配置

```java
// 文件位置: com.damors.zuji.network.ApiConfig
public static final String PUBLISH_FOOTPRINT = "publishMsg";
```

### 3. 网络服务方法

```java
// 文件位置: com.damors.zuji.network.HutoolApiService
public void publishFootprint(PublishTrandsInfoPO publishInfo,
                           SuccessCallback<String> successCallback,
                           ErrorCallback errorCallback) {
    String url = BASE_URL + ApiConfig.Endpoints.PUBLISH_FOOTPRINT;
    
    Map<String, Object> params = new HashMap<>();
    params.put("userId", publishInfo.getUserId());
    params.put("locationInfo", publishInfo.getLocationInfo());
    params.put("type", publishInfo.getType());
    params.put("content", publishInfo.getContent());
    params.put("tag", publishInfo.getTag());
    params.put("lng", publishInfo.getLng());
    params.put("lat", publishInfo.getLat());
    
    // 处理图片路径列表
    if (publishInfo.getImagePaths() != null && !publishInfo.getImagePaths().isEmpty()) {
        String imagePathsStr = String.join(",", publishInfo.getImagePaths());
        params.put("imagePaths", imagePathsStr);
    }
    
    executePostRequest(url, params, String.class, successCallback, errorCallback);
}
```

## 使用示例

### 基本使用

```java
// 获取API服务实例
HutoolApiService apiService = HutoolApiService.getInstance(context);

// 创建发布信息对象
PublishTrandsInfoPO publishInfo = new PublishTrandsInfoPO();
publishInfo.setUserId("12345");
publishInfo.setContent("今天在北京游玩，天气很好！");
publishInfo.setLocationInfo("北京市朝阳区");
publishInfo.setType("旅游");
publishInfo.setTag("旅游,北京,美好时光");
publishInfo.setLng(116.4074);
publishInfo.setLat(39.9042);

// 设置图片路径（可选）
List<String> imagePaths = Arrays.asList(
    "/storage/emulated/0/Pictures/photo1.jpg",
    "/storage/emulated/0/Pictures/photo2.jpg"
);
publishInfo.setImagePaths(imagePaths);

// 调用发布接口
apiService.publishFootprint(publishInfo, 
    new HutoolApiService.SuccessCallback<String>() {
        @Override
        public void onSuccess(String response) {
            Log.d(TAG, "足迹发布成功: " + response);
            // 处理成功响应
        }
    },
    new HutoolApiService.ErrorCallback() {
        @Override
        public void onError(String errorMessage) {
            Log.e(TAG, "足迹发布失败: " + errorMessage);
            // 处理错误响应
        }
    }
);
```

### 发布纯文字足迹

```java
public void publishTextFootprint(String userId, String content, 
                               String locationInfo, Double lng, Double lat) {
    PublishTrandsInfoPO publishInfo = new PublishTrandsInfoPO();
    publishInfo.setUserId(userId);
    publishInfo.setContent(content);
    publishInfo.setLocationInfo(locationInfo);
    publishInfo.setLng(lng);
    publishInfo.setLat(lat);
    publishInfo.setType("动态");
    
    HutoolApiService.getInstance(context).publishFootprint(publishInfo,
        response -> {
            // 成功处理
            Toast.makeText(context, "发布成功", Toast.LENGTH_SHORT).show();
        },
        error -> {
            // 错误处理
            Toast.makeText(context, "发布失败: " + error, Toast.LENGTH_SHORT).show();
        }
    );
}
```

### 发布带图片的足迹

```java
public void publishFootprintWithImages(String userId, String content, 
                                     List<String> imagePaths) {
    PublishTrandsInfoPO publishInfo = new PublishTrandsInfoPO();
    publishInfo.setUserId(userId);
    publishInfo.setContent(content);
    publishInfo.setImagePaths(imagePaths);
    publishInfo.setType("图片分享");
    
    HutoolApiService.getInstance(context).publishFootprint(publishInfo,
        response -> {
            Log.d(TAG, "图片足迹发布成功");
        },
        error -> {
            Log.e(TAG, "图片足迹发布失败: " + error);
        }
    );
}
```

## 注意事项

1. **用户ID必填**: 发布足迹时必须提供有效的用户ID
2. **内容必填**: 足迹内容不能为空
3. **图片处理**: 图片路径列表会被转换为逗号分隔的字符串发送给服务器
4. **网络状态**: 接口会自动检查网络状态，网络不可用时会将请求加入待处理队列
5. **错误处理**: 建议在错误回调中提供用户友好的错误提示
6. **权限要求**: 确保应用有网络访问权限

## 错误处理

常见错误及处理方式：

- **网络不可用**: 请求会自动加入待处理队列，网络恢复后自动重试
- **参数错误**: 检查必填字段是否正确填写
- **服务器错误**: 根据错误信息提示用户重试或联系客服
- **认证失败**: 检查用户登录状态和token有效性

## 相关文件

- `PublishTrandsInfoPO.java` - 发布参数实体类
- `HutoolApiService.java` - 网络服务类
- `ApiConfig.java` - API配置类
- `PublishFootprintExample.java` - 使用示例类